<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SHELL脚本编程大全笔记 | Succw Blog :)</title>
  <meta name="author" content="獨菰、瑉">
  
  <meta name="description" content="运成功者的谦词，命失败者的借口">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="SHELL脚本编程大全笔记"/>
  <meta property="og:site_name" content="Succw Blog :)"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">

  <link rel="alternate" href="/atom.xml" title="Succw Blog :)" type="application/atom+xml">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/print.css" media="print" type="text/css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>

  <script src="/js/scripts.js"></script>

  
  
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config(
    {
      tex2jax: {inlineMath: [['$','$'], ['\(','\)']]},
      TeX: {equationNumbers: {autoNumber: ["AMS"], useLabelIds: true}},
    }
  );
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  
</head>


<body>
    <div class="container">
      <div class="left-col">
        <div class="intrude-less">
          <header id="header" class="inner">
            <div class="profilepic">
  <script src="/js/md5.js"></script>
  <script type="text/javascript">
    $(function(){
	$('.profilepic').append(
          "<img src='http://www.gravatar.com/avatar/"
          + MD5("tivon.su@gmail.com")
          + "?s=160' alt='Profile Picture' style='width: 160px;' />");
    });
  </script>
</div><!-- profilepic -->
<h1><a href="/">獨菰、瑉</a></h1>
<nav id="main-nav">
  <ul class="main">
    
      <li>
      <a href="/about">About</a>
      </li>
    
  </ul>
  
  <section class="aboutme">
    <p>
      运成功者的谦词，命失败者的借口
    </p>
  </section>
  
</nav><!-- main-nav -->
<nav id="sub-nav">
  <div class="social">
    
      <a class="google" href="http://plus.google.com/"
         title="Google+">Google+</a>
    
    
      <a class="twitter" href="http://twitter.com/"
         title="Twitter">Twitter</a>
    
    
      <a class="github" href="http://github.com/"
         title="Github">Github</a>
    
    
        <a class="rss" href="/atom.xml" title="RSS">RSS</a>
    
  </div>
</nav><!-- sub-nav -->
<nav id="widget-nav">
  <div class="widgets">
    
      
<div class="widget tag">
  <h3 class="title">標籤</h3>
  <ul class="entry">
  
    <li><a href="/tags/Linux/">Linux</a><small>8</small></li>
  
    <li><a href="/tags/VMware/">VMware</a><small>9</small></li>
  
    <li><a href="/tags/Windows/">Windows</a><small>2</small></li>
  
    <li><a href="/tags/svn/">svn</a><small>1</small></li>
  
    <li><a href="/tags/音乐/">音乐</a><small>2</small></li>
  
  </ul>
</div>


    
  </div>
</nav><!-- widget-nav -->

          <header>
        </div><!-- intrude-less -->
      </div><!-- left-col -->
      <div class="mid-col">
        <div class="mid-col-container">
	    <div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
	<div class="meta">
          
<div class="date">

<time datetime="2014-01-23T11:15:18.000Z"
      
      data-updated="true"
       itemprop="datePublished">
  1月 23 2014
</time>





</div>

          
          
<div class="print">打印</div>

          
	</div>
        <h1 class="title" itemprop="name">SHELL脚本编程大全笔记</h1>
      	<div class="entry-content" itemprop="articleBody"><h6 id="shell-">SHELL脚本编程大全笔记</h6>
<hr>
<ul>
<li>A=$[  $1 * $2 ] 直接运算。</li>
<li>total=$[ ${10} * ${11} ]</li>
</ul>
<p>各种i++</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="comment">$((i=i</span><span class="literal">+</span><span class="comment">1))</span>
<span class="comment">$((i</span><span class="literal">+</span><span class="literal">+</span><span class="comment">))</span>
<span class="comment">$</span><span class="title">[</span> <span class="comment">i</span><span class="literal">+</span><span class="literal">+</span> <span class="title">]</span>
<span class="comment">let</span> <span class="comment">"i</span><span class="literal">+</span><span class="literal">+</span><span class="comment">"</span>
<span class="comment">((i</span><span class="literal">+</span><span class="literal">+</span><span class="comment">))</span>
</pre></td></tr></table></figure>

<p><strong><strong>使用双尖括号</strong></strong></p>
<p><strong>(( expression  ))</strong></p>
<p>比如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="shebang">#!/bin/bash</span>
a=<span class="number">10</span>
<span class="keyword">if</span> (( <span class="variable">$a</span> ** <span class="number">2</span> &gt;<span class="number">90</span>  )) ;<span class="keyword">then</span>
        <span class="built_in">echo</span> <span class="string">"<span class="variable">$a</span>"</span>
        (( b = <span class="variable">$a</span> ** <span class="number">2</span> ))
        <span class="built_in">echo</span> <span class="variable">$b</span>
<span class="keyword">fi</span>
</pre></td></tr></table></figure>

<p>还有其他表达式：</p>
<h2 id="-http-localhost-8080-png-"><img src="http://localhost:8080/双括号.png" alt=""></h2>
<p><em>使用双方括号</em></p>
<p><strong>[[ expression ]]</strong></p>
<p>模式匹配，你可以自定义正则表达式。</p>
<h6 id="for-c-">for循环语句 { 类C语言 }</h6>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">for</span>((<span class="operator">a</span>=<span class="number">1</span>;<span class="operator">a</span>&lt;<span class="number">5</span>;<span class="operator">a</span>++)){
	echo <span class="string">"$a"</span>
}
</pre></td></tr></table></figure>

<p><em>or</em></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>Shell 格式：
<span class="keyword">for</span>((a=<span class="number">1</span>;a&lt;<span class="number">5</span>;a++))
<span class="keyword">do</span>
	<span class="built_in">echo</span> <span class="string">"<span class="variable">$a</span>"</span>
<span class="keyword">done</span>
</pre></td></tr></table></figure>

<hr>
<p><strong>重定向</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>for(()){

} &gt; /output.txt

<span class="code">-----
or
-----</span>
for(())
do
done | sort
</pre></td></tr></table></figure>

<p>${!#} 返回命令行的脚本名</p>
<p>$*    保存单个单词</p>
<p>$@  保存，类似数组</p>
<hr>
<p><strong>getopt</strong></p>
<p>处理命令行选项和参数</p>
<figure class="highlight `"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="shebang">#!/bin/bash</span>
`<span class="keyword">set</span> --   getopt -q ab:c <span class="string">"<span class="variable">$@</span>"</span>` `
<span class="keyword">while</span> [ -n <span class="variable">$1</span> ]
<span class="keyword">do</span>
	<span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span>
    	<span class="operator">-a</span>) <span class="built_in">echo</span> <span class="string">"Found the -a option"</span> ;;
        -b) param=<span class="string">"<span class="variable">$2</span>"</span>
        	  <span class="built_in">echo</span> <span class="string">"Found the -b option.with parameter value <span class="variable">$param</span>"</span>
              shift;;
        -c)
        	<span class="built_in">echo</span> <span class="string">"Found the -c option"</span> ;;
        --) shift
        	<span class="keyword">break</span>;;
         *) <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span> is not an option"</span> ;;
shift
<span class="keyword">done</span>
</pre></td></tr></table></figure>

<h5 id="-getopts-"><strong>getopts</strong></h5>
<p><del>page284</del></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="shebang">#!/bin/bash</span>
<span class="comment">#</span>
<span class="keyword">while</span> <span class="built_in">getopts</span> <span class="string">":ab:cd"</span> opt 
<span class="keyword">do</span>
<span class="keyword">case</span> <span class="string">"<span class="variable">$opt</span>"</span> <span class="keyword">in</span>
        a) <span class="built_in">echo</span> <span class="string">"Option \"a\""</span>;;
        b) <span class="built_in">echo</span> <span class="string">"Option \"b\" "</span><span class="variable">$OPTARG</span><span class="string">""</span>;;
        c) <span class="built_in">echo</span> <span class="string">"Option \"c\""</span>;;
        d) <span class="built_in">echo</span> <span class="string">"Option \"d\""</span>;;
        <span class="keyword">esac</span>
<span class="keyword">done</span>
<span class="keyword">exit</span> <span class="number">0</span>
```language
</pre></td></tr></table></figure>

<hr>
<p><strong>永久重定向</strong></p>
<p>--在脚本中添加下行</p>
<p><code>exec 1&gt;outfile</code></p>
<p>所有正常输出将重定向至outfile中。</p>
<p><code>exec 2&gt;outfile</code></p>
<p>错误输出</p>
<h6 id="-shell-9-">在Shell中最多可以有9个打开的文件描述符</h6>
<p>创建自定义文件描述符（3-8）</p>
<p>比如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="shebang">#!/bin/bash</span>
<span class="keyword">exec</span> <span class="number">3</span>&gt;outfile3.out
<span class="comment">#exec 3&gt;&gt;outfile3.out</span>
<span class="comment">#顾名思义是追加</span>
<span class="built_in">echo</span> <span class="string">"输出正常"</span> &gt;&<span class="number">3</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre><span class="shebang">#!/bin/bash
</span>
<span class="keyword">exec</span> <span class="number">6</span>&lt;&<span class="number">0</span>
<span class="keyword">exec</span> <span class="number">0</span>&lt; testfile

count=<span class="number">1</span>
<span class="keyword">while</span> <span class="built_in">read</span> line
<span class="keyword">do</span>
        <span class="built_in">echo</span> <span class="string">"Line #<span class="variable">$count</span>: <span class="variable">$line</span>"</span>
        ((count++))
<span class="keyword">done</span>

<span class="keyword">exec</span> <span class="number">0</span>&lt;&<span class="number">6</span>

<span class="built_in">read</span> <span class="operator">-s</span> -p  <span class="string">"Are you done now?"</span> answer
<span class="keyword">case</span> <span class="variable">$answer</span> <span class="keyword">in</span>
        y|y)
                <span class="built_in">echo</span> <span class="string">"Goodbye"</span>
        ;;
        N|n)
                <span class="built_in">echo</span> <span class="string">"sorry. this is the end."</span>
        ;;
        *)
                <span class="built_in">echo</span> <span class="string">"Doesn't Matter"</span>
        ;;
<span class="keyword">esac</span>
</pre></td></tr></table></figure>

<p>关闭文件描述符</p>
<p><code>exec 3&gt;&amp;-</code></p>
<p><code>mktemp -t test.XXXXXX</code></p>
<p>在/tmp目录下创建临时文件</p>
<p><code>mktemp -d dir.XXXXXX</code></p>
<hr>
<p>捕捉信号：</p>
<p>trap command SIGINT SIGTERM</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre>1) SIGHUP	2) SIGINT	3) SIGQUIT	4) SIGILL	5) SIGTRAP
6) SIGABRT	7) SIGBUS	8) SIGFPE	9) SIGKILL	10) SIGUSR1
11) SIGSEGV	12) SIGUSR2	13) SIGPIPE	14) SIGALRM	15) SIGTERM
16) SIGSTKFLT	17) SIGCHLD	18) SIGCONT	19) SIGSTOP	20) SIGTSTP
21) SIGTTIN	22) SIGTTOU	23) SIGURG	24) SIGXCPU	25) SIGXFSZ
26) SIGVTALRM	27) SIGPROF	28) SIGWINCH	29) SIGIO	30) SIGPWR
31) SIGSYS	34) SIGRTMIN	35) SIGRTMIN+1	36) SIGRTMIN+2	37) SIGRTMIN+3
38) SIGRTMIN+4	39) SIGRTMIN+5	40) SIGRTMIN+6	41) SIGRTMIN+7	42) SIGRTMIN+8
43) SIGRTMIN+9	44) SIGRTMIN+10	45) SIGRTMIN+11	46) SIGRTMIN+12	47) SIGRTMIN+13
48) SIGRTMIN+14	49) SIGRTMIN+15	50) SIGRTMAX-14	51) SIGRTMAX-13	52) SIGRTMAX-12
53) SIGRTMAX-11	54) SIGRTMAX-10	55) SIGRTMAX-9	56) SIGRTMAX-8	57) SIGRTMAX-7
58) SIGRTMAX-6	59) SIGRTMAX-5	60) SIGRTMAX-4	61) SIGRTMAX-3	62) SIGRTMAX-2
63) SIGRTMAX-1	64) SIGRTMAX
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="shebang">#!/bin/bash</span>
trap <span class="string">"echo 'ByeBye'"</span> EXIT

<span class="keyword">for</span>((a=<span class="number">1</span>;a&lt;<span class="number">10</span>;a++)){
	<span class="built_in">echo</span> <span class="string">"Line <span class="variable">$a</span>"</span>
    sleep <span class="number">1</span>
}
trap - EXIT
<span class="built_in">echo</span> <span class="string">"移除退出信号"</span>
</pre></td></tr></table></figure>

<p><strong>crontab</strong></p>
<p>每月最后一天</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">if</span> [ `<span class="built_in">date</span> +%d -d tomorrow` = <span class="number">01</span> ]; <span class="keyword">then</span>
	<span class="command"><span class="keyword">command</span></span>
fi
</pre></td></tr></table></figure>

<p><code>00 12 * * * if [ `date +%d -d tomorrow` = 01 ];then : command</code></p>
</div>


</article>

  <div class="share">
  <div class="addthis_toolbox addthis_default_style ">
  
  
  <a class="addthis_button_tweet"></a>
  
  
  <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
  
  
  </div>
  <script type="text/javascript">
    var addthis_config = {"data_track_addressbar":true};
  </script>
  <script type="text/javascript"
          src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=null">
  </script>
</div>




</div>
	</div>
        <footer id="footer" class="inner">
          Copyright © 2013 - 獨菰、瑉 - Powered by <a href="https://github.com/tommy351/hexo">Hexo</a><br>
- Ported theme <a href="https://github.com/nuklly/hexo-theme-greyshade">GreyShade</a> -
        </footer>
        
<script src="/js/slash.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




      </div><!-- mid-col -->
    </div><!-- container -->
</body>
</html>
